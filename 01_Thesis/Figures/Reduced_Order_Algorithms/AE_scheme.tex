\begin{tikzpicture}

%input layer
\foreach \x [count=\y] in {0,.5,1.0,1.5,2,2.5}
	\node[circ] at (0,\x) (\y) {};
%hidden layer
\foreach \x  [count=\y from 7] in {0.25,0.75,1.25,1.75,2.25}
	\node[circ] at (3,\x) (\y) {};
%code layer
\foreach \x [count=\y from 12] in {0.75,1.25,1.75}
\node[circ] at (6, \x) (\y) {};
%hidden layer
\foreach \x  [count=\y from 15] in {0.25,0.75,1.25,1.75,2.25}
\node[circ] at (9,\x) (\y) {};
%output layer
\foreach \x [count=\y from 20] in {0,.5,1.0,1.5,2,2.5}
\node[circ] at (12, \x)   (\y) {};
\begin{pgfonlayer}{background}
%draw connections
\foreach \x in {1,...,6}
\foreach \y in {7,...,11}
	\draw (\x) -- (\y);
\foreach \x in {7,...,11}
\foreach \y in {12,...,14}
\draw (\x) -- (\y);
\foreach \y in {12,...,14}
\foreach \x in {15,...,19}
\draw (\x) -- (\y);
\foreach \y in {15,...,19}
\foreach \x in {20,...,25}
\draw (\x) -- (\y);
\end{pgfonlayer}
%node calculation
\node[draw=none] at (-2,2.5) (input) {\footnotesize $I$};
\node[draw=none] at (-1.5,2.5) (weight) {\footnotesize $w$};
\node[circ] at (-1.75,1.5) (times) {\footnotesize $\times$};
\node[draw=none] at (-2.5,2.5) (bias){\footnotesize $b$};
\node[circ] at (-1.75,.5) (plus) {\footnotesize $+$};
\node[draw=none] at (-1.75,-.5)(output) {\footnotesize $O$};
\draw [arrow,thin](input) to [bend right](times);
\draw [arrow,thin](weight) to [bend left](times);
\draw [arrow,thin](times) -- (plus) node[near start,xshift=1ex] {\footnotesize $I^*$};
\draw [arrow,thin](bias) to [bend right](plus);
\draw [arrow,thin](plus) -- (output);
%rec around calc
\draw[thick] (-2.7,2.7) rectangle  (-1.2,-.7);
\draw[arrow,thin] (-2,2.7) to [bend left] ($(6)!0.5!(11)$);
%rec enc
\draw[thick,dashed,blue] (-1,-1) rectangle  (6.3,3.5) ;
\draw [draw=none] (-1,3.5) -- (6.3,3.5) node [midway,below,draw=none,blue] 
{Encoder: \(h(\Pi)=\Phi\)};
%rec dec
\draw[thick,dashed,red] (13,3.5) rectangle  (5.7,-1) ;
\draw [draw=none] (13,3.5) -- (5.7,3.5) node [midway,below,draw=none,red] 
{Decoder: g(\Phi)=$\tilde{\Pi}$};
%%forpass
\draw[arrow,thick] (0,3.6)--(12,3.6)node [near start,above]{\footnotesize Forward Pass};
%bckpass
\draw[arrow,thick] (12,4.1)--(0,4.1)node [near start,above]{\footnotesize Backward Pass};

\draw [thick,decorate,decoration={brace,mirror, amplitude=3pt}] (-.3,-.3) -- (.3,-.3) node [midway, below = 4pt,draw=none] {\footnotesize Input Layer};
\draw [thick,decorate,decoration={brace,mirror, amplitude=3pt}] (2.7,0) -- (3.3,0) node [midway,below = 6pt,draw=none] 
{\footnotesize Hidden Layer};

\draw [thick,decorate,decoration={brace,mirror, amplitude=3pt}] (8.7,0) -- (9.3,0) node [midway,below = 6pt,draw=none] 
{\footnotesize Hidden Layer};

\draw [thick,decorate,decoration={brace,mirror, amplitude=3pt}] (5.7,0.45) -- (6.3,0.45) node [midway,below = 6pt,draw=none,fill=white] 
{\footnotesize Code Layer};

\draw [thick,decorate,decoration={brace,mirror,amplitude=3pt}] (11.7,-.3) -- (12.3,-.3) node [midway,below = 4pt,draw=none,xshift=-.9ex] {\footnotesize Output Layer};
\end{tikzpicture}
