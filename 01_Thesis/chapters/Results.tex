% !TEX root = master.tex

\chapter{Results}
\label{Ch:Results}
%\pagenumbering{arabic}
This chapter covers the evaluation of reconstructions \(\tilde{f}\) obtained from the FCNN and the CNN through a comparison against reconstructions obtained from POD. Additionally, an analysis of the interpretability of the intrinsic variables \(\idhy\) and \(\idrare\) is provided. This chapter concludes with the attempt to create new states of the FOM with the FCNN and the CNN, which can be viewed as an online phase of MOR.\\ 
To begin with the benchmarking of POD and neural networks, the number of parameters to obtain \(\tilde{f}\) is contrasted. Beforehand solely the number of trainable parameters that compose both neural networks were called \(\frepar\). For this comparison, \(\frepar\) is extended to also include all elements of the left and right singular vectors as well as the singular values of POD. Additionally the amount of intrinsic variables used for reconstruction is set to \(p=3\) and \(p=5\) for \(\hy\) and \(\rare\) respectively. An exception is the CNN, that uses \(p=5\) independent from rarefaction level. A summary is provided in \cref{Tab: Parameters}.   
\begin{table}[htp]
	\centering
	\caption{Amount of parameters \(\frepar\) used to reconstruct \(f\), number  of intrinsic variables \(p\) and the corresponding $\L2$-Error for POD, FCNN and CNN.}
	\begin{tabular*}{16cm}{ @{\extracolsep{\fill}} c c c c c c c @{} }
		\toprule
		Algorithm & \multicolumn{2}{c}{Parameters \(\frepar\)} & \multicolumn{2}{c}{Int. variables \(p\)}& \multicolumn{2}{c}{$\L2$-Error} \\ [.5ex]
		 & \(\hy\)&\(\rare\)&\(\hy\)&\(\rare\)&\(\hy\)&\(\rare\)\\   
		\hline
		POD     & 15129 & 25225 & 3 & 5 & 0.0205 & 0.0087 \\
		FCNN 	& 2683 & 3725 & 3 & 5 & 0.0008 & 0.0009 \\
		CNN   	& 8246 & 8246 & 5 & 5 &	0.025 & 0.027\\
		\bottomrule
	\end{tabular*} \label{Tab: Parameters}
\end{table}
POD uses with 15129 and 25225 parameters to reconstruct \(\hy\) and \(\rare\) respectively the largest amount of parameters of all three algorithms. These yield \(\L2\)-errors of 0.0205 and 0.0087 respectively. Interestingly, the elevation of \(p\) amounts to an increase of paramters by approximately 1.7 which is comparable to the FCNN with an approximate increase of 1.4. The FCNN, which holds the best \(\L2\)-errors of 0.0008 and 0.0009 for \(\hy\) and \(\rare\) respectively, does so with the least amount of parameters. For reconstructing \(\hy\) solely 2683 and for the reconstruction of \(\rare\) solely 3725 parameters are used, which is a fraction of the need for POD. The second most populous alhorithm is the CNN which uses 8246 parameters for both rarefaction levels. The resulting \(\L2\)-errors with 0.025 for \(\hy\) and 0.027 for \(\rare\) of all algorithms. \\

Next a qualitative analysis with actual reconstructions is presented. For this purpose the \(\L2\)-error over time \(t\), seen in \cref{Fig:ErrTime}, is used.\\  
\begin{figure}[tp!]
	\input{Figures/Chapter_5/ErrTime.tex}
	\caption{Relative Error over time for POD, FCNN and CNN. Results for $\hy$ are displayed on the left, the results for $\rare$ are displayed on the right.}
	\label{Fig:ErrTime}
\end{figure}
With POD and the CNN the last timestep at $t=0.12s$ for both rarefaction levels is the most rich in the $L2$-Error. In contrast, the FCNN does not show a distinct time dependence of the \(\L2\)-error. Nonetheless, struggles at the onset at around $t=0.005s$ with $\hy$ and around \(t=0.005s\) and \(t=0.0115\) (in the beginning and at the end) with $\rare$ can be observed for the FCNN. Examples of reconstructions $\tilde{f}(x,v,t_i)$ with $t_i=0.12s$ and $x \in [75cm,150cm]$ are given in \cref{Fig:ErrWorst}.
\begin{figure}[tp!]
	\input{Figures/Chapter_5/ErrWorst.tex}
	\caption{Comparison of the FOM solution \(f\) with three reconstructions \(\tilde{f}\) obtained from POD, the FCNN and the CNN. Case $\hy$ is displayed in the top row, $\rare$ in the bottom row. The colobars reference \(f\) and \(\tilde{f}\).}
	\label{Fig:ErrWorst}
\end{figure}
A presentation of the FOM in $f(x,v)$ was already introduced in \cref{Ch:BGK}. For clarity, $f(x_0,v)$ is a probability distribution for a gas having a velocity $v$ at point $x_0$ in space at one moment $t_i$ in time.\\
Top row in \cref{Fig:ErrWorst} show reconstructions for $\hy$ and the bottom row for $\rare$ with FOM solution as paradigm. Starting with \(\hy\) one observers, that a restored \(f(x,v)\) from \(x=120\), the point around which dilution initiates, gets defective for POD and the CNN. Here the probability distribution is thinner as the original with POD and smeared around the borders with the CNN. This in turn leads to errors in velocities gas particles can have once passing \(x=120\). In contrast the FCNN reproduces the FOM solution almost exactly.\\
Continuing with a row further down of \cref{Fig:ErrWorst} and therefore \(\rare\), in place of a pronounced separation in a dense and rare region, stands bifurcation of \(f(x,v)\) into two probability distribution functions as outlined in \cref{Ch:BGK}. POD and the FCNN reproduce the FOM solution without any visible drawback. On the other hand the CNN reproduces smeared corners as in \(\hy\).   
\begin{figure}[H]
	\input{Figures/Chapter_5/MacroError.tex}
	\caption{Matching of macroscopic quantities \(\rho\), \(\rho u\) and \(E\) reproduced by POD, FCNN, and CNN with FOM macroscopic quantities. Top row shows results for \(\hy\), bottom row for \(\rare\). CNN is displayed with marks only because of trembles in the signal.}
	\label{Fig:ErrMacro}
\end{figure}
Loss of information described above can unfold in severe mistakes in \(\rho\), \(\rho u\) and \(E\), the macroscopic quantities, as displayed in \cref{Fig:ErrMacro}. In the following, features of the macroscopic quantities are expressed in terms of rarefaction wave, contact discontinuity and height as well as position of the shockfront. For a detailed elaboration see \cref{Ch:BGK}. Following the structure in the preceding figures, macroscopic quantities of \(\hy\) are displayed in the top row and for \(\rare\) in the bottom row of \cref{Fig:ErrMacro}. First the reproduction of the macroscopic quantities \(\rho\), \(\rho u\) and \(E\), obtained by the FCNN is exact for both cases \(\hy\) and \(\rare\). In particular the density \(\rho\) matches with results from the FOM exactly for the neural networks in both cases \(\hy\) and \(\rare\). Second the CNN produces trembles in \(\rho u\) and especially in \(E\) which is why it's shown with marks only. Results from the CNN are similar for \(\hy\) and \(\rare\). The momentum \(\rho u\) holds errors for the tail of the rarefaction wave as well as the contact discontinuity and the position and height of the shockwave. Third POD performs better on \(\rare\), holding only small deviations in the contact discontinuity and position and height of the shockwave for the momentum \(\rho u\) and the total energy \(E\). The density \(\rho\) matches with the FOM solution exact. Distinct deviations from the FOM solution occur using POD on \(\hy\). The density \(\rho\) holds errors in the  height of the shockwave. The momentum \(\rho u\) holds errors in the tail of the rarefaction wave, the contact discontinuity and the height of the shockwave. Hence in the total energy \(E\) errors occur in the rarefaction wave, especially the tail, the contact discontinuity and the height of the shockwave.
\begin{figure}[H]
	\input{Figures/Chapter_5/Conservation.tex}
	\caption{Comparison of the conservative properties of reconstructions obatined from POD, the FCNN and the CNN against the conservative properties of the FOM solution using the temporal mean.}
	\label{Fig:Conservation}
\end{figure}
Conservative properties of the FOM are discussed in \cref{Ch:BGK}. Now we want to estimate if the conservation of mass, momentum and total energy could be sustained using POD, the FCNN, and the CNN. To do so, the temporal mean over the time derivative of the macroscopic quantities is employed. \Cref{Fig:Conservation} shows the conservation of mass, momentum and total energy over time for \(\hy\) in the top row and for \(\rare\) in the bottom row.\\
Conservation of mass is met using the FCNN, except for small deviations at the outset for both cases \(\hy\) and \(\rare\). Similarly, does POD meet conservation of mass for \(\rare\). The erroneous \(\hy\) case shows deviations from conservation with POD. Conservation of momentum meets the FOM solution after \(t=0.03s\) using the FCNN for both cases \(\hy\) and \(\rare\). POD conserves momentum close to the FOM solution, but deviations are similarly present for \(\hy\) and \(\rare\). Next conservation of total energy is met for \(\hy\) and \(\rare\) using POD and the FCNN. Finally the reconstructions of the CNN do not conserve mass, momentum nor total energy. All conservative properties behave comparable to a sawtooth wave. A gain and loss of either of the quantities can be observed.\\
In conclusion the error over time for the CNN is disordered, showing gain and subsequent loss of information from one timestep to another. The CNN performs slighly better with \(\hy\) than with \(\rare\). What is hidden when looking at reconstructions becomes visible when verifying over the macroscopic quantities. Reconstructions obtained from the CNN show oscillations in the momentum \(\rho u\) and the total energy \(E\). On top of that the CNN does not meet conservation in any of the conservative properties. All of this together makes the CNN with this setup, especially the access to only 40 samples, unsuited for building a ROM. Next POD shows a noticeable increase in loss of information over time for both cases \(\hy\) and \(\rare\). Reconstructions of the last timestep as well as the macroscopic quantities at that time reveal that the POD is unsuited for building a ROM with the \(\hy\)case. However, with \(\rare\) POD shows only slight deviations from the FOM solution. Taking conservative properties of the reconstructions obtained from POD into consideration only underlines aforementioned findings. Ultimately POD could be taken for building a ROM with \(\rare\). Finally the the FCNN is the best performing model out of the three for both cases \(\hy\) and \(\rare\), while the performance for \(\hy\) is slightly better than that for \(\rare\). The error over time reveals a constant low loss. Only at the first time steps a noticeable loss of information is observed. Reconstructions of the last time step and the macroscopic quantities at that time are close to exact to the FOM solution for both cases \(\hy\) and \(\rare\). The conservation of the macroscopic quantites only emphasize the proximity to the FOM solution. In total the FCNN is suited for building a ROM with both cases \(\hy\) and \(\rare\) and will be taken further into the online phase.\\
We now reached the online phase where we want to be independent from the FOM solution. A first ROM relying on pure interpolation in the intrinsic variables is performed for \(\hy\). The intrinsic variables of the FCNN for \(\hy\) are shown in ... . 

With POD one usually exploits the intrinsic variables within a Galerkin framework as in \cite{Bernard} to produce new states. The same can be done with the intrinsic variables obtained from autoencoders as in \cite{Carlberg}. Both won't be discussed in this contribution. Rather new states are obtained by interpolating \(\idhy\) and \(\idrare\) in time \(t\). This approach tests a different kind of generalization about the FOM solution. Therefore this kind of generalization ability of the proposed autoencoder architectures will be analyzed.

\begin{figure}[H]
	\input{Figures/Chapter_5/Code2D_hy_FCNN.tex}
	\caption{\(\alpha_1\), \(\alpha_2\) and \(\alpha_3\), the reduced basis \(\idhy\) obtained from the FCNN.}
\end{figure}
\begin{figure}[H]
	\input{Figures/Chapter_5/Hy_Int.tex}
	\caption{Interpoaltionin in time for \(\hy\) from 25 snapshots to 241 snapshots with cubic splines using the FCNN.}
\end{figure}
\begin{figure}[H]
	\scalebox{1}{\input{Figures/Chapter_5/Hydro/MacroCode10.tex}}
	\caption{Code variables \(c_1\), \(c_2\) and \(c_3\) (dashed lines - -) and macroscopic quantities \(\rho\), \(E\), \(\rho u\) (full lines --) for \(t=0.05s\).}
\end{figure}
\begin{figure}[H]
	\scalebox{1}{\input{Figures/Chapter_5/Hydro/MacroCode20.tex}}
	\caption{Code variables \(c_1\), \(c_2\) and \(c_3\) (dashed lines - -) and macroscopic quantities \(\rho\), \(E\), \(\rho u\) (full lines --) for \(t=0.099s\).}
\end{figure}
\begin{figure}[H]
	\scalebox{.6}{\input{Figures/Chapter_5/Hydro/PODConvCode.tex}}
	\caption{Comparison of the intrinsic variables generated by POD \(\gamma_1\), \(\gamma_2\) and \(\gamma_3\) with the intrinsic variables of the convolutional autoencoder \(\beta_1\), \(\beta_2\) and \(\beta_3\).}
\end{figure}
\begin{figure}[H]
	\scalebox{0.9}{\input{Figures/Chapter_5/Rare/Code.tex}}
	\caption{Intrinsic Variables of $\rare$}
\end{figure}
\subsection{Discussion and Outlook}
 One reason of the lacking ability of the CNN is the small number of samples, as described in \cref{Ch:ApB} and \cref{Ch:ROM}. The resulting trembles of the signal when calculating the macroscopic quantities is due the kernel approach of the CNN. During reconstruction the resolution of the output image is bounded by the size of the kernel, which leads to pixelation.\\
  What we see here is the known drawback of POD. Sharp fronts and especially advection dominated problems lead to a fast decaying kogolomorov n-width. These problems need a nonlienar ansatz, as described in \cref{Ch:ROM}.