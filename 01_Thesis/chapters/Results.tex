% !TEX root = master.tex

\chapter{Results}
\label{Ch:Results}
%\pagenumbering{arabic}
This chapter covers the evaluation of reconstructions \(\tilde{f}\) obtained from the FCNN and the CNN through a comparison against reconstructions obtained from POD. Additionally, an analysis of the interpretability of the intrinsic variables \(\idhy\) and \(\idrare\) is provided. This chapter concludes with the attempt to create new states of the FOM with the FCNN and the CNN, which can be viewed as an online phase of MOR.\\ 
To begin with the benchmarking of POD and neural networks, the number of parameters to obtain \(\tilde{f}\) is contrasted. Beforehand solely the number of trainable parameters that compose both neural networks were called \(\frepar\). For this comparison, \(\frepar\) is extended to also include all elements of the left and right singular vectors as well as the singular values of POD. Additionally the amount of intrinsic variables used for reconstruction is set to \(p=3\) and \(p=5\) for \(\hy\) and \(\rare\) respectively. An exception is the CNN, that uses \(p=5\) independent from rarefaction level. A summary is provided in \cref{Tab: Parameters}.   
\begin{table}[htp]
	\centering
	\caption{Amount of parameters \(\frepar\) used to reconstruct \(f\), number  of intrinsic variables \(p\) and the corresponding $\L2$-Error for POD, FCNN and CNN.}
	\begin{tabular*}{16cm}{ @{\extracolsep{\fill}} c c c c c c c @{} }
		\toprule
		Algorithm & \multicolumn{2}{c}{Parameters \(\frepar\)} & \multicolumn{2}{c}{Int. variables \(p\)}& \multicolumn{2}{c}{$\L2$-Error} \\ [.5ex]
		 & \(\hy\)&\(\rare\)&\(\hy\)&\(\rare\)&\(\hy\)&\(\rare\)\\   
		\hline
		POD     & 15129 & 25225 & 3 & 5 & 0.0205 & 0.0087 \\
		FCNN 	& 2683 & 3725 & 3 & 5 & 0.0008 & 0.0009 \\
		CNN   	& 8246 & 8246 & 5 & 5 &	0.025 & 0.027\\
		\bottomrule
	\end{tabular*} \label{Tab: Parameters}
\end{table}
POD uses with 15129 and 25225 parameters to reconstruct \(\hy\) and \(\rare\) respectively the largest amount of parameters of all three algorithms. These yield \(\L2\)-errors of 0.0205 and 0.0087 respectively. Interestingly, the elevation of \(p\) amounts to an increase of paramters by approximately 1.7 which is comparable to the FCNN with an approximate increase of 1.4. The FCNN, which holds the best \(\L2\)-errors of 0.0008 and 0.0009 for \(\hy\) and \(\rare\) respectively, does so with the least amount of parameters. For reconstructing \(\hy\) solely 2683 and for the reconstruction of \(\rare\) solely 3725 parameters are used, which is a fraction of the need for POD. The second most populous alhorithm is the CNN which uses 8246 parameters for both rarefaction levels. The resulting \(\L2\)-errors with 0.025 for \(\hy\) and 0.027 for \(\rare\) are the largest of all three algorithms. \\

Next a qualitative analysis with actual reconstructions is presented. For this purpose the \(\L2\)-error over time \(t\), seen in \cref{Fig:ErrTime}, is used to localize the most challenging snapshot for each algorithm.\\ 
\begin{figure}[tp!]
	\input{Figures/Chapter_5/ErrTime.tex}
	\caption{\(\L2\)-error over time for POD, FCNN and CNN. Results for $\hy$ are displayed on the left, the results for $\rare$ are displayed on the right.}
	\label{Fig:ErrTime}
\end{figure}
With POD and the CNN the last timestep at $t=0.12s$ for both rarefaction levels is the most rich in the $L2$-Error. In contrast, the FCNN does not show a distinct time dependence of the \(\L2\)-error. Nonetheless, struggles at the onset at around $t=0.005s$ with $\hy$ and around \(t=0.005s\) and \(t=0.0115\) (in the beginning and at the end) with $\rare$ can be observed for the FCNN. Examples of reconstructions $\tilde{f}(x,v,t_i)$ with $t_i=0.12s$ and $x \in [0.375,0.75]$ are given in \cref{Fig: ErrWorst}.\\
\begin{figure}[tp!]
	\input{Figures/Chapter_5/ErrWorst.tex}
	\caption{Comparison of the FOM solution \(f\) with three reconstructions \(\tilde{f}\) obtained from POD, the FCNN and the CNN. Reconstrucions are shown at \(t=0.12s\) for \(x\in [0.375,0.75]\). Case $\hy$ is displayed in the top row, $\rare$ in the bottom row. The colobars reference \(f\) and \(\tilde{f}\).}
	\label{Fig: ErrWorst}
\end{figure}
The FOM solution viewed as $f(x,v,t_i)$ has been introduced in \cref{Ch:BGK}. There, $f(x_j,v,t_i)$ is the probability distribution of the microscopic velocities $v$ at point $x_j$ in space at one moment $t_i$ in time for a gas.
With this in mind, a qualitative comparison between the three algorithms can be made considering the rendition of the velocity probabilities. Starting with \(\hy\), seen in the top row of \cref{Fig: ErrWorst} one can observe that \(\tilde{f}(x,v,t_i)\) starting around \(x=0.6\) gets defective for POD and the CNN. Noteworthy, here the probability distribution is thinner as the original with POD. This in turn leads to errors in the temperature \(T\) once passing \(x\approx 0.6\). Prominent qualitative deviations using the CNN are especially blurriness/pixelation of \(\tilde{f}(x,v,t_i)\) after \(x\approx 0.6\). In contrast the FCNN seems to reproduce the FOM solution almost exactly.\\
Continuing with a row further down in \cref{Fig: ErrWorst} and therefore with \(\rare\). The FCNN seems to reproduce the FOM solution without any visible drawback. Also POD seems to reproduce all important structures, except after \(x\approx 0.7\) around the contact discontinuity, some values for velocities with \(v>0\) appear to be missing. Again the CNN struggles with blurriness making \(\tilde{f}\) for both rarefaction levels look largely similar.    
\begin{figure}[H]
	\input{Figures/Chapter_5/MacroError.tex}
	\caption{Matching of macroscopic quantities \(\rho\), \(\rho u\) and \(E\) reproduced by POD, the FCNN the and CNN with macroscopic quantities computed from the FOM. Top row shows results for \(\hy\), bottom row for \(\rare\) at time \(t_i=0.12s\). CNN is displayed with marks only because of trembles in the signal.}
	\label{Fig:ErrMacro}
\end{figure}
Loss of information described above can unfold in severe mistakes in \(\rho\), \(\rho u\) and \(E\), the macroscopic quantities, as displayed in \cref{Fig:ErrMacro}. Examining the macroscopic quantities enables a detailed look on the reconstruction errors. Features of the macroscopic quantities are expressed in terms of rarefaction wave, contact discontinuity and height as well as position of the shockfront. For a detailed elaboration of these terms see \cref{Ch:BGK}. Following the structure in the preceding figures, macroscopic quantities of \(\hy\) are displayed in the top row and for \(\rare\) in the bottom row of \cref{Fig:ErrMacro}. First the reproduction of the macroscopic quantities \(\rho\) and \(\rho u\)  obtained by the FCNN match the FOM exact for both levels of rarefaction \(\hy\) and \(\rare\). Interestingly, despite the overall impressive performance of the FCNN regarding the small number of parameters it uses, the total energy shows small deviations around the tail of the rarefaction wave for \(\hy\) and somewhat severe errors at the transition form rarefaction wave to shock front for \(\rare\). Second the CNN produces trembles in \(\rho u\) and especially in \(E\) which is why it's shown with marks only. The macroscopic quantities reproduced by the CNN show unmissable, it's inabillity to differentiate between \(\hy\) and \(\rare\). Specifically, seem the macroscopic quantities for \(\rare\) appear to be a copy of the the ones for \(\hy\). Additionally, considering \(\hy\), one can observe, that the momentum \(\rho u\) holds small errors for the tail of the rarefaction wave as well as the contact discontinuity. The value for the tip of the shockwave exceeds, comparable with POD, the exact solution. Third POD performs better on \(\rare\), which is not suprising considering the the difference in number of used parameters, holding only small deviations of the contact discontinuity and the shockwave for the momentum \(\rho u\) and the total energy \(E\). The density \(\rho\) matches the FOM solution exact. Pronounced deviations from the FOM solution occur using POD on \(\hy\). The density \(\rho\) undercuts the original shockwave. The momentum \(\rho u\) heavily exceeds the tail of the rarefaction wave and in the same extent undercuts the contact discontinuity. Hence in the total energy \(E\) the same is observable for the tail of the rarefaction wave and the contact discontinuity.
\begin{figure}[H]
	\input{Figures/Chapter_5/Conservation.tex}
	\caption{Comparison of the conservative properties of reconstructions obatined from POD, the FCNN and the CNN against the conservative properties of the FOM solution using the temporal mean.}
	\label{Fig:Conservation}
\end{figure}
The physical consistency of \(\tilde{f}\), in terms of conservation of mass momentum and energy is a critical criteria for it's validity. Hence conservation properties are analyzed in the following. In that respect, the temporal mean over the time derivative, which can be calculated exemplary for \(\rho\) with
\begin{equation}
	\frac{\mathrm{d}}{\mathrm{d}t}\int \rho(x,t)\, \mathrm{d}x\Delta t  =\overline{\dot{\rho}}\mathrm{,}
\end{equation}
of the macroscopic quantities is employed. \Cref{Fig:Conservation} shows the conservation of mass, momentum and total energy as a temporal mean for \(\hy\) in the top row and for \(\rare\) in the bottom row.\\
Conservation of mass is met using the FCNN, except for small deviations at the outset for both cases \(\hy\) and \(\rare\). Similarly, does POD meet conservation of mass for \(\rare\). The erroneous \(\hy\) case losses mass at the onset and gains mass towards the end with POD. Conservation of momentum meets the FOM solution, except for minor gains and losses, after \(t\approx 0.03s\) using the FCNN for both cases \(\hy\) and \(\rare\). POD gains momentum of 0.13 for \(\hy\) and 0.07 for \(\rare\). The conservation of total energy is met for \(\hy\) and \(\rare\) using POD and the FCNN. Finally the reconstructions of the CNN do not conserve mass, momentum nor total energy. All conservative properties behave comparable to a sawtooth wave. A gain and loss of either of the quantities can be observed.\\

Because of the black-box nature of neural networks the question of interpretability often arises when working with them \cite{fan2021interpretability}. Especially benchmarking neural networks for model order reduction with POD asks for the evaluation of the interpretability of the intrinsic variables. Owing to the tremendous quality of POD, which lies in "the physically interpretable decomposition"\cite{Kutz}[p.375] of the input data, as stated in \cref{Ch:DimRedAl}.\\
Following the deduction, that \(\hy\) can be completely described in terms of three macroscopic quantities and that \(\rare\) is describable in a similar way, it is put to test if the intrinsic variables \(\idhy\) and \(\idrare\) show any similarities, if not match any macroscopic quantity. To this end two supplementary macroscopic quantities namely the temperature \(T\) and macroscopic velocity \(u\) are added to the three macroscopic variables. In \cref{Fig: Macro_hy} and \cref{Fig: Macro_rare} those are depicted first over the whole domain of \(x\) and \(t\) and for two specific timesteps \(t=0.055s\) and \(t=0.12s\) for \(\hy\) and \(\rare\) respectively. Similarily are the intrinsic variables \(\idhy\) and \(\idrare\) with\\\\
\begin{minipage}{0.45\textwidth}
	\begin{equation}
		[h_0(x,t),\dots,h_p(x,t)] = \idhy
	\end{equation}
\end{minipage}%
\begin{minipage}{0.45\textwidth}
	\begin{equation}
		\mathrm{and}\quad[r_0(x,t),\dots,r_p(x,t)] = \idrare
	\end{equation}
\end{minipage},\\\\\
depicted in \cref{Fig: Code_hy} and \cref{Fig: Code_rare} respectively.\\
Strikingly, most intrinsic variables appear to be a sort of linear combination of the five intrinsic variables. In particular \(\idhy\). For example do the rarefaction wave, shock wave and contact discontinutity, that can be identified in \(h_0\) reflect a combination of those found in the density \(\rho\) and the total energy \(E\). Furthermore does \(h_1\) seem to be a mirror image of the momentum \(\rho u\), where beginning end values are inspired by the temperature \(T\). Then again \(T\) plays a more pronounced role in \(h_2\), where it's fluctuation appears. The peak of \(h_2\) could be guessed from the peak of the macroscopic velocity \(u\) with it's bump at \(t=0.12\).\\
A clear identification of macroscopic quantities that can be seen in \(\idrare\) is possible for \(r_3\), which reflects the shape of the density \(\rho\). Moreover, the peak of the velocity \(u\) can be rediscovered in the through of \(r_0\). For other intrinsic variables of \(\idrare\) namely \(r_1\), \(r_2\) and \(r_3\) a clear discernability of macroscopic quantities is not observed. It seems rather that those constitute abstract information about the rarefied flow. Nonetheless it can't be verified, that also those can be created through linear combinations of the intrinsic variables.
\clearpage
\begin{figure}[htp!]
	\input{Figures/Chapter_5/fom_mac_hy.tex}
	\caption{Macroscopic quantities of \(\hy\). Density \(\rho\), momentum \(\rho u\), total energy \(E\), teperature \(T\) and velocity \(u\) over time \(t\) and space \(x\) in the top row and specifically at \(t_i=0.055s\) and \(t_i=0.12\) in the middle and bottom row respectively.}
	\label{Fig: Macro_hy}
\end{figure}
\begin{figure}[hbp!]
	\input{Figures/Chapter_5/fom_mac_rare.tex}
		\caption{Macroscopic quantities of \(\rare\). Density \(\rho\), momentum \(\rho u\), total energy \(E\), teperature \(T\) and velocity \(u\) over time \(t\) and space \(x\) in the top row and specifically at \(t_i=0.055s\) and \(t_i=0.12\) in the middle and bottom row respectively.}
	\label{Fig: Macro_rare}
\end{figure}
\clearpage
\begin{figure}[htp!]
	\centering
	\input{Figures/Chapter_5/code_hydro.tex}
	\caption{Intrinsic variables \(h_0(x,t)\), \(h_1(x,t)\) and \(h_2(x,t)\) of \(\idhy\) obtained from the FCNN. Top row depicts \(\idhy\) over the whole \((x,t)\) domain, middle and bottom row for \(t=0.055\) and \(t=0.12\) respectively.}
	\label{Fig: Code_hy}
\end{figure}
\begin{figure}[hbp!]
	\input{Figures/Chapter_5/code_rare.tex}
	\caption{Intrinsic variables \(r_0(x,t)\), \(r_1(x,t)\), \(r_2(x,t)\), \(r_3(x,t)\) and \(r_4(x,t)\) of \(\idrare\) obtained from the FCNN. Top row depicts \(\idrare\) over the whole \((x,t)\) domain, middle and bottom row for \(t=0.055\) and \(t=0.12\) respectively.}
	\label{Fig: Code_rare}
\end{figure}
\clearpage
The intrinsic variables extracted from the CNN and POD are shown in \cref{Fig: CNNPOD}. They are only dependent on \(v\) with\\
\begin{minipage}{0.45\textwidth}
	\begin{equation}
	[h_1(v),\dots,h_p(v)] = \idhy
	\end{equation}
\end{minipage}%
\begin{minipage}{0.45\textwidth}
	\begin{equation}
	\mathrm{and}\quad[r_n(v),\dots,r_p(v)] = \idrare
	\end{equation}
\end{minipage}.\\\\\
Third and fourth row of \cref{Fig: CNNPOD} show the first three and five POD modes of \(\hy\) and \(\rare\). As the bulk dynamic answer of the two gas flows to the test case do not differ dramatically, it is expected, that the first three modes of both rarefaction levels don't differ a lot as seen in \cref{Fig: CNNPOD}. Pronounced differences of \(\idhy\) and \(\idrare\) extracted from the CNN, senn in the first and second row of \cref{Fig: CNNPOD}, are also not observed. This aligns with previous findings that the CNN fails to differentiate between \(\hy\) and \(\rare\). Qualitatively do the intrinsic variables of the CNN show less complexity compared to those of POD, nonetheless a rough analogy between the two can be observed. Especially \(h_0\)/\(r_0\), the first intrinsic variables, of the CNN resemble those of POD. Furthermore can a small through in \(h_1\)/\(r_1\) of the CNN be identified which is present, although much more pronounced, in \(h_1\)/\(r_1\) of POD. Worth mentioning is that \(h_0\) and \(r_0\), \(h_1\) and \(r_1\) as well as \(h_4\) and \(r_4\) of the CNN encompass the largest peaking of all intrinsic variables.\\    
\begin{figure}[hp!]
	\input{Figures/Chapter_5/code_cnn_pod.tex}
	\caption{Intrinsic variables \(h_0(v)\), \(h_1(v)\), \(h_2(v)\), \(h_3(v)\) and \(h_4(v)\) of \(\idhy\) in the top row and \(r_0(v)\), \(r_1(v)\), \(r_2(v)\), \(r_3(v)\) and \(r_4(v)\) of \(\idrare\) of in the second row extracted from the CNN. Third and fourth row show \(h_0(v)\), \(h_1(v)\), \(h_2(v)\) of \(\idhy\) and \(r_0(v)\), \(r_1(v)\) , \(r_2(v)\), \(r_3(v)\) and \(r_4(v)\) of \(\idrare\) extracted from POD respectively.}
	\label{Fig: CNNPOD}
\end{figure}

With POD one usually exploits the intrinsic variables within a Galerkin framework as in \cite{Bernard} to produce new states. The same can be done with the intrinsic variables obtained from autoencoders as in \cite{Carlberg}. Both won't be discussed in this contribution. Rather new states are obtained by performing an interpolation in time \(t\) of \(\idhy\) and \(\idrare\). This approach tests a different kind of ability to generalize about the FOM solution. So far there have been two kinds of generalization tested: The first can be encountered during training, where a split into train- and validation set probes the ability to fit unseen examples. A second approach into generalization is tried with the CNN, where both rarefaction levels as training examples probes the ability to fit both in the same model. The third insight into the ability to generalize is tested now using the FCNN. By the temporal interpolation in the intrinsic variables it is probed if new states can be generated that meet the condition of MOR that the distance \(||f - \tilde{f}||\) is small.\\
For this thesis an additional solution \(\hy^*\) of the BGK model in Sod's shock tube with \(\Kn=0.00001\) is provided with a temporal resolution of 241 snapshots. Hence an interpolation using cubic splines in the temporal axis of \(\idhy\) is performed. The resulting intrinsic variables called \(\idhy^*\) are then fed into the decoder of the FCNN generating \(\widetilde{\hy}^*\). \(\hy^*\) against \(\widetilde{\hy}^*\) as truth agains prediction in terms of macroscopic quantities density \(\rho\), momentum \(\rho u\) and total energy \(E\) is provided in \cref{Fig: IntHy}.
\begin{figure}[H]
	\input{Figures/Chapter_5/Hy_Int.tex}
	\caption{Microscopic quantities density \(\rho\), momentum \(\rho u\) and total Energy \(E\), displayed in this order, at time \(t=0.12\) against predictions generated from interpolation. Temporal interpolation with cubic splines is perofrmed in \(\idhy\) from 25 snaptshots to 241 snapshots.}
	\label{Fig: IntHy}
\end{figure}
The resulting \(\L2\)-error increases to \(\L2=0.0012\) 
In conclusion the error over time for the CNN is disordered, showing gain and subsequent loss of information from one timestep to another. The CNN performs slighly better with \(\hy\) than with \(\rare\). What is hidden when looking at reconstructions becomes visible when verifying over the macroscopic quantities. Reconstructions obtained from the CNN show oscillations in the momentum \(\rho u\) and the total energy \(E\). On top of that the CNN does not meet conservation in any of the conservative properties. All of this together makes the CNN with this setup, especially the access to only 40 samples, unsuited for building a ROM. Next POD shows a noticeable increase in loss of information over time for both cases \(\hy\) and \(\rare\). Reconstructions of the last timestep as well as the macroscopic quantities at that time reveal that the POD is unsuited for building a ROM with the \(\hy\)case. However, with \(\rare\) POD shows only slight deviations from the FOM solution. Taking conservative properties of the reconstructions obtained from POD into consideration only underlines aforementioned findings. Ultimately POD could be taken for building a ROM with \(\rare\). Finally the the FCNN is the best performing model out of the three for both cases \(\hy\) and \(\rare\), while the performance for \(\hy\) is slightly better than that for \(\rare\). The error over time reveals a constant low loss. Only at the first time steps a noticeable loss of information is observed. Reconstructions of the last time step and the macroscopic quantities at that time are close to exact to the FOM solution for both cases \(\hy\) and \(\rare\). The conservation of the macroscopic quantites only emphasize the proximity to the FOM solution. In total the FCNN is suited for building a ROM with both cases \(\hy\) and \(\rare\) and will be taken further into the online phase.\\
\subsection{Discussion and Outlook}
 One reason of the lacking ability of the CNN is the small number of samples, as described in \cref{Ch:ApB} and \cref{Ch:ROM}. The resulting trembles of the signal when calculating the macroscopic quantities is due the kernel approach of the CNN. During reconstruction the resolution of the output image is bounded by the size of the kernel, which leads to pixelation.\\
  What we see here is the known drawback of POD. Sharp fronts and especially advection dominated problems lead to a fast decaying kogolomorov n-width. These problems need a nonlienar ansatz, as described in \cref{Ch:ROM}.